#!/usr/bin/env perl
use strict;
use warnings;
use DBI;
use Data::Dumper;
use Dotenv -load;

my $drakkar = DBI->connect(
    sprintf('DBI:Pg:database=%s;host=%s', $ENV{'DRAKKAR_DB_DATABASE'}, $ENV{'DRAKKAR_DB_HOSTNAME'}),
    $ENV{'DRAKKAR_DB_USERNAME'},
    $ENV{'DRAKKAR_DB_PASSWORD'},
);

my $vinland = DBI->connect(
    sprintf('DBI:Pg:database=%s;host=%s', $ENV{'VINLAND_DB_DATABASE'}, $ENV{'VINLAND_DB_HOSTNAME'}),
    $ENV{'VINLAND_DB_USERNAME'},
    $ENV{'VINLAND_DB_PASSWORD'},
);

my $select_methods_sth = $drakkar->prepare('
    SELECT psimi_id, name FROM methods ORDER BY id ASC
');

$select_methods_sth->execute;

my $methods = $select_methods_sth->fetchall_arrayref;

$vinland->do('COPY methods(psimi_id, name) FROM STDIN');

$vinland->pg_putcopydata(join("\t", @{$_}) . "\n") foreach (@{$methods});

$vinland->pg_putcopyend();
